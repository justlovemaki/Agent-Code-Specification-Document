数据库规范文档 (Database Specification Document)

本规范旨在确保数据库结构的清晰、性能的高效和维护的便捷性。

1.1. 建表规约

【强制】 表达“是/否”概念的字段，必须使用 is_xxx 的方式命名，数据类型为 unsigned tinyint (1 表示是，0 表示否)。

说明: POJO 类中对应的属性名不要加 is 前缀。需要在 ORM 映射中配置 is_xxx 到 xxx 的映射关系。

正例: 逻辑删除字段命名为 is_deleted。

【强制】 表名、字段名必须使用小写字母或数字，禁止出现数字开头，禁止两个下划线中间只出现数字。

说明: 为了避免跨操作系统的大小写敏感问题，统一使用小写。

正例: aliyun_admin, rdc_config

反例: AliyunAdmin, level_3_name

【强制】 表名不使用复数名词。

【强制】 禁用保留字，如 desc、range、match 等。

【强制】 表必备三字段：id, create_time, update_time。

说明: id 必须为 bigint unsigned 类型的主键，单表时自增。create_time 和 update_time 的类型均为 datetime。

【强制】 主键索引名为 pk_字段名；唯一索引名为 uk_字段名；普通索引名为 idx_字段名。

【强制】 小数类型使用 decimal，禁止使用 float 和 double。

说明: float 和 double 存在精度损失风险。

【强制】 如果存储的字符串长度几乎相等，使用 char 定长字符串类型。

【强制】 varchar 是可变长字符串，长度不应超过 5000。若大于此值，应定义为 text 类型，并独立成表，用主键对应。

【强制】 禁止使用物理删除，必须使用逻辑删除。

说明: 使用 is_deleted 字段标记。

【推荐】 单表行数超过 500 万行或单表容量超过 2GB，才推荐进行分库分表。

1.2. 索引规约

【强制】 业务上具有唯一特性的字段，即使是多个字段的组合，也必须建立唯一索引。

【强制】 超过三个表禁止 join。需要 join 的字段，数据类型必须绝对一致；多表关联查询时，保证被关联的字段需要有索引。

【强制】 在 varchar 字段上建立索引时，必须指定索引长度，没必要对全字段建立索引。

【强制】 页面搜索严禁左模糊或者全模糊，如果需要请走搜索引擎来解决。

【推荐】 order by 场景请注意利用索引的有序性。order by 最后的字段是组合索引的一部分，且放在组合索引的最后，避免 filesort。

【推荐】 利用覆盖索引来进行查询操作，避免回表。

【推荐】 建组合索引的时候，区分度最高的在最左边。

1.3. SQL 语句规约

【强制】 不要使用 count(列名) 或 count(常量) 来替代 count(*)。

【强制】 sum() 的使用要注意 NPE 问题，使用 IFNULL(SUM(col), 0) 来处理。

【强制】 使用 ISNULL() 来判断是否为 NULL 值。

【强制】 不得使用外键与级联，一切外键概念必须在应用层解决。

【强制】 禁止使用存储过程，难以调试和扩展，没有移植性。

【强制】 数据订正时，先 select，避免误操作。

【推荐】 in 操作能避免则避免，若实在避免不了，需要仔细评估 in 后边的集合元素数量，控制在 1000 个之内。

1.4. ORM 映射规约

【强制】 在表查询中，一律不要使用 * 作为查询的字段列表，需要哪些字段必须明确写明。

【强制】 POJO 类的布尔属性不能加 is，而数据库字段必须加 is_，要求在 resultMap 中进行字段与属性之间的映射。

【强制】 sql.xml 配置参数使用 #{}, #param# 不要使用 ${} 此种方式容易出现 SQL 注入。

【强制】 不允许直接拿 HashMap 与 Hashtable 作为查询结果集的输出。

